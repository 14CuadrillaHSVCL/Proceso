<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡Sálvense Quien Pueda! - FINAL</title>
    <style>
        /* CSS para los efectos bonitos y el estilo */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #1a1a2e;
            font-family: 'Arial', sans-serif;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        h1 { color: #ffcc00; text-shadow: 2px 2px 4px #000000; }
        #game-container {
            border: 5px solid #ffcc00;
            box-shadow: 0 0 20px #ffcc00, 0 0 10px #ff00ff;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        canvas { background-color: #5d5d81; display: block; }
        #score-board {
            margin-top: 15px; font-size: 1.5em; color: #ffffff;
            background-color: #333366; padding: 10px 20px;
            border-radius: 5px; border: 2px solid #ffcc00;
        }
        #jump-button {
            margin-top: 20px; padding: 15px 30px; font-size: 1.2em;
            font-weight: bold; color: #1a1a2e; background-color: #00ff7f;
            border: none; border-radius: 8px; cursor: pointer;
            box-shadow: 0 5px #00b359; transition: background-color 0.1s;
            width: 80%; max-width: 300px;
        }
        #jump-button:active {
            box-shadow: 0 2px #00b359; transform: translateY(3px); background-color: #00e673;
        }
        .instructions { margin-top: 10px; text-align: center; font-size: 0.9em; }
    </style>
</head>
<body>

    <h1>¡Sálvense Quien Pueda!</h1>

    <div id="score-board">
        Puntuación: <span id="score">0</span>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>

    <button id="jump-button">JUMP / SALTAR</button>

    <p class="instructions">
        **PC:** Barra Espaciadora o W. &nbsp; | &nbsp; **Móvil:** Toca el botón de Salto.
    </p>

    <script>
        // --- JAVASCRIPT: El Motor del Juego ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const jumpButton = document.getElementById('jump-button'); 

        // --- Configuración del Juego ---
        const WIDTH = 800;
        const HEIGHT = 400;
        const GRAVITY = 0.6;
        const JUMP_POWER = 12;
        const GROUND_Y = HEIGHT - 40; 
        let score = 0;
        
        // --- Objeto del Jugador (El Aventurero) ---
        const player = {
            x: 50,
            y: GROUND_Y,
            width: 30,
            height: 40,
            velocityY: 0,
            
            draw() {
                ctx.fillStyle = '#00ff7f';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeStyle = '#000000'; 
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
            },

            // LÓGICA DE MOVIMIENTO CRÍTICA
            update() {
                // Aplica gravedad y actualiza la posición Y
                this.velocityY += GRAVITY;
                this.y += this.velocityY;

                // CORRECCIÓN DE SUELO: Si el jugador está por debajo del suelo, lo regresa al suelo
                if (this.y >= GROUND_Y) {
                    this.y = GROUND_Y;
                    this.velocityY = 0;
                }
            },

            // FUNCIÓN DE SALTO SIMPLIFICADA AL MÁXIMO
            jump() {
                // Solo permitimos saltar si el jugador está en el suelo (elimina el 'spam jump')
                if (this.y === GROUND_Y) {
                    this.velocityY = -JUMP_POWER; // Mueve hacia arriba
                }
            }
        };

        // --- (Resto del código de Monedas y Dibujo es igual) ---
        let coins = [];
        const COIN_SIZE = 15;
        const COIN_COLOR = '#ffcc00';

        function createCoin() {
            const yPos = GROUND_Y - (Math.random() * 100 + 30); 
            coins.push({ x: WIDTH, y: yPos, size: COIN_SIZE, speed: 3 });
        }

        function drawCoins() {
            coins.forEach(coin => {
                ctx.fillStyle = COIN_COLOR;
                ctx.beginPath();
                ctx.arc(coin.x + coin.size / 2, coin.y + coin.size / 2, coin.size / 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowColor = '#ffff00';
                ctx.shadowBlur = 5;
                ctx.beginPath();
                ctx.arc(coin.x + coin.size / 2, coin.y + coin.size / 2, coin.size / 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            });
        }

        function updateCoins() {
            for (let i = coins.length - 1; i >= 0; i--) {
                coins[i].x -= coins[i].speed;
                if (
                    player.x < coins[i].x + coins[i].size && player.x + player.width > coins[i].x &&
                    player.y < coins[i].y + coins[i].size && player.y + player.height > coins[i].y
                ) {
                    score++;
                    scoreElement.textContent = score;
                    coins.splice(i, 1);
                } else if (coins[i].x + coins[i].size < 0) {
                    coins.splice(i, 1);
                }
            }
            if (Math.random() < 0.02) { createCoin(); }
        }

        function drawGround() {
            ctx.fillStyle = '#3a2708';
            ctx.fillRect(0, GROUND_Y + player.height, WIDTH, 40);
            ctx.fillStyle = '#228b22';
            ctx.fillRect(0, GROUND_Y, WIDTH, 5); 
        }
        
        // --- Bucle Principal del Juego ---
        function gameLoop() {
            ctx.clearRect(0, 0, WIDTH, HEIGHT);
            drawGround();
            player.update(); // <-- El movimiento se recalcula aquí
            player.draw();
            updateCoins();
            drawCoins();

            requestAnimationFrame(gameLoop);
        }

        // --- Control de Entrada: TECLADO (Para PC) ---
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' || event.code === 'KeyW') { 
                event.preventDefault();
                player.jump();
            }
        });

        // --- Control de Entrada: BOTÓN/TOUCH (Para Móvil) ---
        jumpButton.addEventListener('touchstart', (event) => {
             event.preventDefault();
             player.jump();
        });
        jumpButton.addEventListener('click', (event) => {
             player.jump();
        });

        // --- Inicio del Juego ---
        gameLoop();
    </script>
</body>
</html>
